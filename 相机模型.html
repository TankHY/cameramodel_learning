<html>
<head>
  <title>相机模型</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600753 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="463"/>
<h1>相机模型</h1>

<div>
<span><div>1、相机成像包括的四大坐标系：世界坐标系、相机坐标系、图像坐标系、像素坐标系</div><div>    世界坐标系：人为将物理坐标系设置在空间某个位置，张正友将世界坐标系设置在棋盘格平面，Z=0</div><div>    相机坐标系：相机坐标系为相机光心位置</div><div>    图像坐标系：传感器平面的中心（焦点）</div><div>    像素坐标系：相机成像后为了表示像素位置建立的，在左上角起始位置</div><div><br/></div><div>2、三种变换：刚体变换、透视变换、仿射变换</div><div><img src="相机模型_files/Image.png" type="image/png" data-filename="Image.png" title="Attachment"/></div><div>世界坐标系到相机坐标系的变换称为刚体变换，不发生形变</div><div>透视变换：3维向2维的变换</div><div>仿射变换：一个图像往另一个图像变换，可能发生形变</div><div><br/></div><div>相机模型：</div><div><br/></div><div>像素坐标系（笛卡尔坐标系）：坐标原点在图像左上角，列表示U轴，行表示V轴，单位为像素</div><div><img src="相机模型_files/Image [1].png" type="image/png" data-filename="Image.png" width="553"/></div><div>图像坐标系：图像坐标系，坐标原点为主光轴到图像中心投影，单位为mm,如下图XY表示图像坐标系</div><div><br/></div><div><img src="相机模型_files/Image [2].png" type="image/png" data-filename="Image.png" width="613"/></div><div>相机坐标系：光心作为相机坐标系的原点0，如下图0-xyz</div><div><img src="相机模型_files/Image [3].png" type="image/png" data-filename="Image.png" width="447"/></div><div>世界坐标系：物理世界指定某个位置为世界坐标系</div><div><img src="相机模型_files/Image [4].png" type="image/png" data-filename="Image.png" width="533"/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </div><div>坐标系变化：</div><div>世界坐标系转化为相机坐标系</div><div><span style="font-size: 18pt; font-family: 等线;"><img src="相机模型_files/Image [5].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 18pt; font-family: 等线;">相机坐标系往图像坐标系变化，三维往二维投影</span></div><div><span style="font-size: 18pt; font-family: 等线;"><img src="相机模型_files/Image [6].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 18pt; font-family: 等线;">三维点（Xc,Yc,Zc）到二维投影变化成相似三角形，如下公式</span></div><div><img src="相机模型_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>将上公式化成下式：</div><div><br/></div><div><img src="相机模型_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div><img src="相机模型_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div>上式化成矩阵形式表示：</div><div><br/></div><div><img src="相机模型_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>像素坐标系与图像坐标系的单位不同，图像坐标系向像素坐标系变换需要进行尺度变换，才能变成像素单位，假设x方向单位像素为dx ,y方向单位像素dy.</div><div>则</div><div><br/></div><div><img src="相机模型_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>因此可以建立像素坐标uv 与相机坐标系的变化关系，这个变化关系被叫做相机的内参矩阵：</div><div><br/></div><div><img src="相机模型_files/Image [12].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><br/></div><div>经过变换后公式下</div><div><br/></div><div><img src="相机模型_files/Image [13].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>因此相机坐标系与像素坐标系变换关系为，p为像素坐标（u,v） Pc为相机坐标系Pc</div><div><br/></div><div><img src="相机模型_files/Image [14].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>像素坐标系与世界坐标系变换关系，上式有相机坐标系与世界坐标系的关系。</div><div><img src="相机模型_files/Image [15].png" type="image/png" data-filename="Image.png"/></div><div>由上面相机模型的相关应用：</div><div>一：视差与什么有关：</div><div>以相机光心o1为世界坐标系p(xw,yw,zw),相机经过立体校正后的模型如下：</div><div><br/></div><div><img src="相机模型_files/Image [16].png" type="image/png" data-filename="Image.png" width="504"/></div><div>由上面视差推导的结果可知：视差与基线 物距 焦距有关。</div><div>二：已知物理世界坐标如何分别投影到图像坐标系的应用:</div><div>Pc为左相机坐标系下的三维点，p为像素坐标系。</div><div><img src="相机模型_files/Image [17].png" type="image/png" data-filename="Image.png"/></div><div>在右相机下的投影</div><div><img src="相机模型_files/Image [18].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>clear all;close all;</div><div>cam1_k_ = [1885,0,1920;0,1885,1080;0,0,1];</div><div>% cam1_k_ = [ 1885.84737, 0.0, 1920;0, 1885.4827, 1080;0.0, 0.0, 1.0];</div><div>cam1_d_ = [ -0.36345, 0.2017, 0.0006544,0.000117648,-0.0718];</div><div>cam2_k_ = [1885,0,1920;0,1885,1080;0,0,1];</div><div>% cam2_k_ = [7367.334/4, 0.0,1920/4;0, 7381.352/4, 1080/4;0.0, 0.0,  1.0];</div><div>cam2_d_ = [-0.26045,-0.78665,0.003781,0.004923,10.237];</div><div>figure();</div><div>hold on;</div><div>deg =0:0.02:0.1;</div><div>dispairty_sum = [];</div><div>dist_IOU = [];</div><div>%%%%%%%角度变换对视差的影响</div><div>for i = 1:length(deg)</div><div>    M = Rot2M('Z',0)*Rot2M('Y',0)*Rot2M('X',deg(i));</div><div>    extrin_para  = eye(4,4);</div><div>    extrin_para (1:3,1:3)=M ;</div><div>    extrin_para(1,4) = 90+deg(i);</div><div>    extrin_para(2,4) = 0;</div><div>    extrin_para(3,4) = 0;</div><div>    extrin_para(4,4) = 1;</div><div>    %%%%%%目标为红绿灯</div><div>   z = 60000;</div><div>   y = 6000;</div><div>    x = 2000;</div><div>    pt_world1 = [x,y,z];</div><div>%%%%%%%lamd*P = k1*Pc</div><div>    pixel_1 = cam1_k_*pt_world1';</div><div>    pixel_1(1) = pixel_1(1)/pixel_1(3);</div><div>    pixel_1(2) = pixel_1(2)/pixel_1(3);</div><div>    pixel_1(3) = 1;</div><div>%%%%%%%lamd*P = k2*[R,T]Pc</div><div>    pt_world2 = [pt_world1,1];</div><div>    pt_Rot_2 =extrin_para*pt_world2';</div><div>    pt_2 = pt_Rot_2/pt_Rot_2(4);</div><div>    pixel_2 =  cam2_k_*(pt_2(1:3));</div><div>    pixel_2(1) = (pixel_2(1)/pixel_2(3));</div><div>    pixel_2(2) = (pixel_2(2)/pixel_2(3));</div><div>    pixel_2(3) = 1;</div><div>    dispairty = [pixel_1(1)-pixel_2(1),pixel_1(2)-pixel_2(2)];</div><div>    dispairty_sum = [dispairty_sum;deg(i),dispairty];</div><div>%%%%%红绿灯大小400</div><div>    traffic_imagesize = 400/(z/1885);  </div><div>    IOU =  (traffic_imagesize-abs(dispairty(1)))*(traffic_imagesize-abs(dispairty(2)))/((traffic_imagesize+abs(dispairty(1)))*(traffic_imagesize+abs(dispairty(2))));</div><div>    distIOU = [deg(i),IOU];</div><div>    dist_IOU = [dist_IOU;distIOU];</div><div>end   </div><div>figure(1)</div><div>hold on;</div><div>plot(dispairty_sum(:,1),abs(dispairty_sum(:,2)),'*');</div><div>plot(dispairty_sum(:,1),abs(dispairty_sum(:,2)));</div><div>plot(dispairty_sum(:,1),abs(dispairty_sum(:,3)),'o');</div><div>plot(dispairty_sum(:,1),abs(dispairty_sum(:,3)));</div><div>legend('x方向产生误差','y方向产生误差')</div><div>title('x角度变化影响')</div><div>figure(2)</div><div>hold on;</div><div>plot(dist_IOU(:,1),abs(dist_IOU(:,2)),'*');</div><div>plot(dist_IOU(:,1),abs(dist_IOU(:,2)));</div><div>for i =1:length(dist_IOU(:,1))</div><div>     text(dist_IOU(i,1),dist_IOU(i,2),['(',num2str(dist_IOU(i,1)),',',num2str(dist_IOU(i,2)),')']);</div><div>end</div><div>%  legend('x????????','y????????')</div><div>title('绕x轴角度变化的对红绿灯IOU影响')</div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">%%%%已知欧拉角度获取外参矩阵</span></div><div>function M = Rot2M(a,B)</div><div>    b = deg2rad(B);</div><div>    switch a</div><div>        case 'X'</div><div>            M= [1,0,0;0,cos(b),-sin(b);0,sin(b),cos(b)];</div><div>        case 'Y'</div><div>           M= [cos(b),0,sin(b);0,1,0;-sin(b),0,cos(b)];</div><div>        case 'Z'</div><div>            M = [cos(b),-sin(b),0;sin(b),cos(b),0;0,0,1];</div><div>    end</div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 